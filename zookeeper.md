# 주키퍼 & 카프카 GCP설치 및 운영

서비스를 보완/개발하다가 실시간 데이터 수집도구인 카프카를 이용하려고 찾아보던중에 주키퍼이야기가 나와서 찾아봤다.

## 주키퍼란?

주키퍼(zookeeper)는 <u>분산 환경 애플리케이션 코디네이터</u>이다.

분산환경 시스템을 구축하고 사용하다보면 여러 서버들사이에서 서로 **정보공유**를 어떻게할것인가 에 대한 고민이많아지는데, 주키퍼는 분산되어있는 서버들사이의 상태정보/ 데이터 공유를 도와주는 코디네이션 시스템이다.

분산되어있는 서버 여러대를 주키퍼 앙상블 클러스터로 구성하여, 동일한 클러스터내에 있는 서버들은 서로 통신하여 상태 및 정보를 교환하고 이 정보들을 <u>지 노드(znode)</u>에 저장한다.

znode에는 키 - 밸류(딕셔너리 타입)으로 앙상블 클러스터로 묶인 서버들이 서로간에 교환한 데이터와 상태정보등을 저장한다.

그렇게 저장한 정보들을 클라이언트가 요구하면 저장한 상태정보와 데이터를 전달한다.  여기서 클라이언트는 **카프카나 다른 분산 어플리케이션이 된다.**

보통 주키퍼 앙상블 클러스터는 1개의 리더 서버와 N개의 팔로워 서버로 구성되어 하나의 클러스터를 이루고 클라이언트와 통신한다.

그리고 주키퍼는 생존해있는 주키퍼 앙상블 클러스터가 과반수일경우, 서비스를 지속해서 제공한다.
그래서인지 <u>주키퍼는 홀수로 구성하는편이좋다.</u>

EX) 주키퍼 앙상블 3대구성

2대가 다운 -> 과반수 이상이 다운되었으므로 서비스중단
1대가 다운 -> 과반수 이상의 서버가 동작하고있으므로 서비스 유지


# GCP에 주키퍼 설치

카프카를 이용하기위해 하둡과 분리하여 새로운 인스턴스를 생성하고, 새로 생성된 인스턴스에 주키퍼를 설치할것이다.
원래 카프카/주키퍼 서버를 분리하는게 좋지만 GCP의 비용문제로..카프카와 주키퍼를 같은 인스턴스에서 사용.


Manual의 인스톨 매뉴얼에 따라 새로생성한 인스턴스에 패키지들을 업데이트/업그레이드해주고 ssh를 설치한다.
그리고 주키퍼를 사용하기위해 JAVA도 설치해준다.
<u>아마존 코레토를 이용하여 JAVA을 설치해도된다.</u> 물론 <u>OpenJDK-~,</u>로 원하는 JAVA 버전을 설치해도된다.

나는 **코레토를 이용해, JAVA11버전을 설치했다.**

[Install Manual 링크](https://github.com/LeNaHod/Manuals/blob/master/install_setting_Manual.md)



## zookeeper 설치 (간략)

